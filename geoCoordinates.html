<!DOCTYPE html>
<html>
  <head>
    <title>Location Tracker</title>
  </head>
  <body>
    <h1>Your Location</h1>
    <p>Latitude: <span id="lat">Getting location...</span></p>
    <p>Longitude: <span id="lng">Getting location...</span></p>
    <p>Source: <span id="source">-</span></p>
    <p>Status: <span id="status">Starting...</span></p>
    <button onclick="getLocation()">Refresh Location</button>

    <script>
      function updateLocation(lat, lng, source) {
        document.getElementById("lat").textContent = lat;
        document.getElementById("lng").textContent = lng;
        document.getElementById("source").textContent = source;
        document.getElementById("status").textContent = "Success!";
      }

      function updateStatus(message) {
        document.getElementById("status").textContent = message;
      }

      // Method 1: Try GPS first
      function tryGPS() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject("GPS not supported");
            return;
          }

          updateStatus("Trying GPS...");
          navigator.geolocation.getCurrentPosition(
            (position) => {
              resolve({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                source: "GPS",
              });
            },
            (error) => {
              reject("GPS failed: " + error.message);
            },
            {
              enableHighAccuracy: false,
              timeout: 10000,
              maximumAge: 300000,
            }
          );
        });
      }

      // Method 2: IP-API.com (free, no key needed)
      function tryIPAPI() {
        return new Promise((resolve, reject) => {
          updateStatus("Trying IP geolocation...");
          fetch("http://ip-api.com/json/?fields=lat,lon,status,message")
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "success") {
                resolve({
                  lat: data.lat,
                  lng: data.lon,
                  source: "IP (ip-api.com)",
                });
              } else {
                reject("IP API failed: " + data.message);
              }
            })
            .catch((error) => reject("IP API error: " + error.message));
        });
      }

      // Method 3: ipapi.co (free, no key needed)
      function tryIPAPI2() {
        return new Promise((resolve, reject) => {
          updateStatus("Trying backup IP service...");
          fetch("https://ipapi.co/json/")
            .then((response) => response.json())
            .then((data) => {
              if (data.latitude && data.longitude) {
                resolve({
                  lat: data.latitude,
                  lng: data.longitude,
                  source: "IP (ipapi.co)",
                });
              } else {
                reject("Backup IP API failed");
              }
            })
            .catch((error) => reject("Backup IP API error: " + error.message));
        });
      }

      // Method 4: freeipapi.com
      function tryFreeIPAPI() {
        return new Promise((resolve, reject) => {
          updateStatus("Trying third IP service...");
          fetch("https://freeipapi.com/api/json")
            .then((response) => response.json())
            .then((data) => {
              if (data.latitude && data.longitude) {
                resolve({
                  lat: data.latitude,
                  lng: data.longitude,
                  source: "IP (freeipapi.com)",
                });
              } else {
                reject("Free IP API failed");
              }
            })
            .catch((error) => reject("Free IP API error: " + error.message));
        });
      }

      // Try all methods in sequence
      async function getLocation() {
        const methods = [tryGPS, tryIPAPI, tryIPAPI2, tryFreeIPAPI];

        for (let method of methods) {
          try {
            const result = await method();
            updateLocation(result.lat, result.lng, result.source);
            return;
          } catch (error) {
            console.log(error);
          }
        }

        // All methods failed
        updateStatus("All location methods failed. Check internet connection.");
      }

      // Start getting location on page load
      getLocation();
    </script>
  </body>
</html>
